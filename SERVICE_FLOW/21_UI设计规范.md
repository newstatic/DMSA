# DMSA UI 设计规范

> 版本: 1.0 | 更新日期: 2026-01-27
>
> 返回 [目录](00_README.md) | 上一节: [20_App启动与交互流程](20_App启动与交互流程.md)

---

## 目录

1. [设计原则](#一设计原则)
2. [设计系统](#二设计系统)
3. [状态栏组件](#三状态栏组件)
4. [菜单栏设计](#四菜单栏设计)
5. [设置窗口](#五设置窗口)
6. [同步详情窗口](#六同步详情窗口)
7. [冲突解决界面](#七冲突解决界面)
8. [磁盘管理界面](#八磁盘管理界面)
9. [弹窗与通知](#九弹窗与通知)
10. [响应式设计](#十响应式设计)
11. [无障碍设计](#十一无障碍设计)
12. [组件规范](#十二组件规范)

---

## 一、设计原则

### 1.1 核心设计理念

DMSA 作为 macOS 菜单栏应用，遵循以下设计理念：

**不打扰 (Unobtrusive)**
应用静默运行在后台，仅在需要用户关注时才主动呈现。状态栏图标是用户与应用的主要接触点，需传达关键状态而不造成视觉干扰。

**即时反馈 (Immediate Feedback)**
每个用户操作都应获得即时视觉反馈。同步进度、操作结果、错误状态都需在适当位置清晰展示。

**渐进披露 (Progressive Disclosure)**
默认展示最常用功能，高级选项隐藏在二级界面。用户可根据需要逐层深入了解更多控制选项。

**一致性 (Consistency)**
遵循 macOS Human Interface Guidelines，使用系统原生控件和交互模式，让用户无需学习即可上手。

### 1.2 设计原则清单

```yaml
design_principles:
  - name: "可预见性"
    description: "用户应能预测操作的结果"
    implementation:
      - "操作前显示确认信息"
      - "破坏性操作使用红色警告"
      - "提供撤销机制"

  - name: "反馈性"
    description: "系统状态应始终可见"
    implementation:
      - "状态栏图标实时反映系统状态"
      - "长时操作显示进度指示"
      - "操作完成后提供确认反馈"

  - name: "容错性"
    description: "允许用户犯错并提供恢复路径"
    implementation:
      - "危险操作要求二次确认"
      - "提供清晰的错误说明"
      - "给出具体的修复建议"

  - name: "效率性"
    description: "为熟练用户提供快捷方式"
    implementation:
      - "支持键盘快捷键"
      - "记住用户偏好设置"
      - "一键完成常用操作"

  - name: "美观性"
    description: "界面简洁、平衡、专业"
    implementation:
      - "遵循 macOS 设计语言"
      - "使用 SF Symbols"
      - "保持视觉层次清晰"
```

---

## 二、设计系统

### 2.1 颜色系统

使用 macOS 系统语义颜色确保自动适配深色模式：

```yaml
color_system:
  semantic_colors:
    primary:
      light: "systemBlue"
      dark: "systemBlue"
      usage: "主要操作按钮、链接、选中状态"

    success:
      light: "systemGreen"
      dark: "systemGreen"
      usage: "成功状态、就绪状态、完成指示"

    warning:
      light: "systemYellow"
      dark: "systemYellow"
      usage: "警告状态、启动中、需要注意"

    error:
      light: "systemRed"
      dark: "systemRed"
      usage: "错误状态、危险操作、失败指示"

    neutral:
      light: "systemGray"
      dark: "systemGray"
      usage: "禁用状态、次要信息、占位符"

  text_colors:
    primary:
      light: "labelColor"
      dark: "labelColor"
      usage: "主要文本、标题"

    secondary:
      light: "secondaryLabelColor"
      dark: "secondaryLabelColor"
      usage: "辅助说明、描述文字"

    tertiary:
      light: "tertiaryLabelColor"
      dark: "tertiaryLabelColor"
      usage: "提示文字、占位符"

  background_colors:
    window:
      light: "windowBackgroundColor"
      dark: "windowBackgroundColor"

    control:
      light: "controlBackgroundColor"
      dark: "controlBackgroundColor"

    selected:
      light: "selectedContentBackgroundColor"
      dark: "selectedContentBackgroundColor"
```

### 2.2 图标系统

```yaml
icon_system:
  source: "SF Symbols 4.0+"
  weight: "regular"
  size_scale:
    small: 12
    medium: 16
    large: 20
    xlarge: 24

  status_bar_icons:
    connecting:
      symbol: "arrow.triangle.2.circlepath"
      color: "systemGray"
      animation: "pulse"

    starting:
      symbol: "hourglass"
      color: "systemYellow"
      animation: "rotate"

    ready:
      symbol: "checkmark.circle.fill"
      color: "systemGreen"
      animation: null

    syncing:
      symbol: "arrow.clockwise"
      color: "systemBlue"
      animation: "rotate"

    error:
      symbol: "exclamationmark.triangle.fill"
      color: "systemRed"
      animation: "pulse"

  menu_icons:
    sync: "arrow.clockwise"
    conflict: "exclamationmark.2"
    disk: "externaldrive"
    settings: "gear"
    log: "doc.text"
    about: "info.circle"
    quit: "power"
```

### 2.3 排版系统

```yaml
typography:
  font_family: "system"  # SF Pro on macOS

  styles:
    largeTitle:
      size: 26
      weight: "bold"
      lineHeight: 32
      usage: "关于窗口主标题"

    title1:
      size: 22
      weight: "semibold"
      lineHeight: 28
      usage: "窗口标题"

    title2:
      size: 17
      weight: "semibold"
      lineHeight: 22
      usage: "分组标题"

    title3:
      size: 15
      weight: "semibold"
      lineHeight: 20
      usage: "列表项标题"

    body:
      size: 13
      weight: "regular"
      lineHeight: 18
      usage: "正文内容"

    callout:
      size: 12
      weight: "regular"
      lineHeight: 16
      usage: "辅助说明"

    caption:
      size: 11
      weight: "regular"
      lineHeight: 14
      usage: "时间戳、状态文字"

    monospaced:
      size: 12
      weight: "regular"
      family: "SF Mono"
      usage: "文件路径、代码"
```

### 2.4 间距系统

```yaml
spacing:
  base_unit: 4  # 所有间距为 4 的倍数

  scale:
    xxs: 2
    xs: 4
    sm: 8
    md: 12
    lg: 16
    xl: 24
    xxl: 32

  component_spacing:
    menu_item_padding:
      horizontal: 16
      vertical: 8

    window_padding:
      top: 20
      bottom: 20
      horizontal: 24

    section_spacing: 24
    item_spacing: 12
    label_spacing: 4
```

---

## 三、状态栏组件

### 3.1 状态图标规范

状态栏图标是应用的主要视觉入口，需在 22x22 像素空间内清晰传达系统状态。

```yaml
status_bar:
  dimensions:
    width: 22
    height: 22
    icon_size: 18
    padding: 2

  states:
    - id: "initializing"
      icon: "circle.dotted"
      color: "systemGray"
      animation:
        type: "pulse"
        duration: 1.5
      tooltip: "DMSA 初始化中..."
      accessibility_label: "DMSA 正在初始化"

    - id: "connecting"
      icon: "arrow.triangle.2.circlepath"
      color: "systemGray"
      animation:
        type: "rotate"
        duration: 2.0
      tooltip: "连接服务中..."
      accessibility_label: "DMSA 正在连接后台服务"

    - id: "starting"
      icon: "hourglass"
      color: "systemYellow"
      animation:
        type: "bounce"
        duration: 1.0
      tooltip: "服务启动中 {progress}%"
      accessibility_label: "DMSA 服务正在启动，进度 {progress}%"

    - id: "ready"
      icon: "externaldrive.badge.checkmark"
      color: "systemGreen"
      animation: null
      tooltip: "DMSA 运行中"
      accessibility_label: "DMSA 运行正常"

    - id: "syncing"
      icon: "arrow.clockwise"
      color: "systemBlue"
      animation:
        type: "rotate"
        duration: 1.0
      tooltip: "同步中 {progress}%"
      accessibility_label: "DMSA 正在同步文件，进度 {progress}%"

    - id: "evicting"
      icon: "trash"
      color: "systemBlue"
      animation:
        type: "pulse"
        duration: 1.5
      tooltip: "清理中 {progress}%"
      accessibility_label: "DMSA 正在清理本地缓存"

    - id: "error"
      icon: "exclamationmark.triangle.fill"
      color: "systemRed"
      animation:
        type: "pulse"
        duration: 2.0
        repeat: 3
      tooltip: "发生错误 - 点击查看详情"
      accessibility_label: "DMSA 遇到错误，点击查看详情"

    - id: "serviceUnavailable"
      icon: "xmark.circle.fill"
      color: "systemRed"
      animation: null
      tooltip: "服务不可用"
      accessibility_label: "DMSA 后台服务不可用"
```

### 3.2 状态转换动画

```yaml
status_transitions:
  duration: 0.3
  timing: "easeInOut"

  rules:
    - from: ["initializing", "connecting"]
      to: "ready"
      animation: "fadeScale"
      celebrate: false

    - from: "starting"
      to: "ready"
      animation: "fadeScale"
      celebrate: true  # 短暂高亮

    - from: "ready"
      to: ["syncing", "evicting"]
      animation: "crossFade"

    - from: ["syncing", "evicting"]
      to: "ready"
      animation: "fadeScale"

    - from: "*"
      to: "error"
      animation: "shake"
      shake_count: 2
```

---

## 四、菜单栏设计

### 4.1 菜单结构

```yaml
menu_structure:
  sections:
    - id: "status"
      items:
        - id: "status_display"
          type: "custom_view"
          view: "StatusHeaderView"
          height: 60
          selectable: false
          content:
            - line1: "{状态图标} {状态文字}"
            - line2: "{统计信息} | {最后同步时间}"
          states:
            ready: "运行中 - {totalFiles} 个文件"
            syncing: "同步中... {progress}%"
            error: "错误: {errorMessage}"

    - id: "separator1"
      items: [{ type: "separator" }]

    - id: "actions"
      items:
        - id: "sync_now"
          type: "button"
          title: "立即同步"
          icon: "arrow.clockwise"
          shortcut: "⌘S"
          enabled_states: ["ready"]
          action: "triggerSync"

        - id: "view_conflicts"
          type: "button"
          title: "查看冲突"
          icon: "exclamationmark.2"
          badge: "{conflictCount}"
          badge_visible_when: "conflictCount > 0"
          shortcut: "⌘K"
          enabled_states: ["ready", "syncing"]
          action: "openConflictWindow"

    - id: "separator2"
      items: [{ type: "separator" }]

    - id: "management"
      items:
        - id: "disk_management"
          type: "button"
          title: "磁盘管理"
          icon: "externaldrive"
          shortcut: "⌘D"
          action: "openDiskManagement"

        - id: "settings"
          type: "button"
          title: "设置..."
          icon: "gear"
          shortcut: "⌘,"
          action: "openSettings"

    - id: "separator3"
      items: [{ type: "separator" }]

    - id: "info"
      items:
        - id: "view_logs"
          type: "button"
          title: "查看日志"
          icon: "doc.text"
          action: "openLogs"

        - id: "about"
          type: "button"
          title: "关于 DMSA"
          icon: "info.circle"
          action: "showAbout"

    - id: "separator4"
      items: [{ type: "separator" }]

    - id: "exit"
      items:
        - id: "quit"
          type: "button"
          title: "退出"
          icon: "power"
          shortcut: "⌘Q"
          action: "quitApp"
```

### 4.2 菜单项状态

```yaml
menu_item_states:
  normal:
    text_color: "labelColor"
    icon_color: "secondaryLabelColor"
    background: "transparent"

  hover:
    text_color: "labelColor"
    icon_color: "labelColor"
    background: "selectedContentBackgroundColor"

  disabled:
    text_color: "tertiaryLabelColor"
    icon_color: "tertiaryLabelColor"
    background: "transparent"
    opacity: 0.5

  highlighted:
    text_color: "white"
    icon_color: "white"
    background: "controlAccentColor"
```

### 4.3 状态头部视图

菜单顶部的自定义状态视图提供丰富的状态信息：

```yaml
status_header_view:
  layout:
    padding: { top: 12, bottom: 12, left: 16, right: 16 }
    height: 60

  components:
    icon:
      size: 32
      position: "left"
      margin_right: 12

    content:
      title:
        font: "title3"
        color: "labelColor"
      subtitle:
        font: "caption"
        color: "secondaryLabelColor"
        margin_top: 2

    progress:
      visible_when: "state in [syncing, starting, evicting]"
      type: "linear"
      height: 4
      position: "bottom"
      margin_top: 8
      color: "controlAccentColor"

  content_mapping:
    ready:
      title: "运行中"
      subtitle: "{totalFiles} 个文件 · {localSize} 本地缓存"

    syncing:
      title: "同步中..."
      subtitle: "{currentFile} · {progress}%"
      show_progress: true

    starting:
      title: "启动中..."
      subtitle: "{phase}"
      show_progress: true

    error:
      title: "发生错误"
      subtitle: "{errorMessage}"
      title_color: "systemRed"

    serviceUnavailable:
      title: "服务不可用"
      subtitle: "点击重试连接"
      clickable: true
```

---

## 五、设置窗口

### 5.1 窗口规范

```yaml
settings_window:
  dimensions:
    width: 500
    height: 400
    min_width: 450
    min_height: 350
    resizable: true

  style:
    type: "preferences"  # macOS 偏好设置样式
    toolbar_style: "preference"
    title: "DMSA 设置"

  tabs:
    - id: "general"
      title: "通用"
      icon: "gear"

    - id: "sync"
      title: "同步"
      icon: "arrow.triangle.2.circlepath"

    - id: "storage"
      title: "存储"
      icon: "internaldrive"

    - id: "disks"
      title: "磁盘"
      icon: "externaldrive"

    - id: "advanced"
      title: "高级"
      icon: "wrench.and.screwdriver"
```

### 5.2 通用设置页

```yaml
general_tab:
  sections:
    - id: "startup"
      title: "启动"
      items:
        - id: "launch_at_login"
          type: "toggle"
          label: "登录时启动"
          description: "开机后自动启动 DMSA"
          default: true
          binding: "config.launchAtLogin"

        - id: "show_in_dock"
          type: "toggle"
          label: "在 Dock 中显示"
          description: "关闭后仅在菜单栏显示"
          default: false
          binding: "config.showInDock"

    - id: "notifications"
      title: "通知"
      items:
        - id: "enable_notifications"
          type: "toggle"
          label: "启用通知"
          description: "同步完成、错误等事件发送通知"
          default: true
          binding: "config.enableNotifications"

        - id: "notification_types"
          type: "multi_select"
          label: "通知类型"
          enabled_when: "config.enableNotifications"
          options:
            - { id: "sync_complete", label: "同步完成" }
            - { id: "conflict_detected", label: "检测到冲突" }
            - { id: "error_occurred", label: "发生错误" }
            - { id: "disk_disconnected", label: "磁盘断开" }
          default: ["sync_complete", "conflict_detected", "error_occurred"]
          binding: "config.notificationTypes"

    - id: "logging"
      title: "日志"
      items:
        - id: "log_level"
          type: "dropdown"
          label: "日志级别"
          options:
            - { value: "debug", label: "调试" }
            - { value: "info", label: "信息" }
            - { value: "warn", label: "警告" }
            - { value: "error", label: "仅错误" }
          default: "info"
          binding: "config.logLevel"
```

### 5.3 同步设置页

```yaml
sync_tab:
  sections:
    - id: "schedule"
      title: "同步计划"
      items:
        - id: "sync_interval"
          type: "slider"
          label: "自动同步间隔"
          min: 60
          max: 3600
          step: 60
          unit: "秒"
          format: "time"  # 显示为 "5 分钟"
          default: 300
          binding: "config.syncInterval"

        - id: "sync_on_disk_connect"
          type: "toggle"
          label: "磁盘连接时自动同步"
          description: "外置磁盘插入后立即开始同步"
          default: true
          binding: "config.syncOnDiskConnect"

    - id: "conflict"
      title: "冲突处理"
      items:
        - id: "conflict_strategy"
          type: "radio_group"
          label: "默认冲突策略"
          options:
            - id: "ask"
              label: "每次询问"
              description: "检测到冲突时弹出选择对话框"

            - id: "keep_local"
              label: "保留本地版本"
              description: "始终保留本地文件"

            - id: "keep_external"
              label: "保留外部版本"
              description: "始终使用外置磁盘上的文件"

            - id: "keep_both"
              label: "保留两者"
              description: "重命名冲突文件保留两个版本"

          default: "ask"
          binding: "config.conflictStrategy"

    - id: "filters"
      title: "排除规则"
      items:
        - id: "exclude_patterns"
          type: "list"
          label: "排除文件"
          description: "匹配的文件不会被同步"
          placeholder: "例如: *.tmp, .DS_Store"
          add_button: "添加规则"
          default:
            - ".DS_Store"
            - "._*"
            - "*.tmp"
            - "Thumbs.db"
          binding: "config.excludePatterns"
```

### 5.4 存储设置页

```yaml
storage_tab:
  sections:
    - id: "overview"
      title: "存储概览"
      items:
        - id: "storage_chart"
          type: "custom_view"
          view: "StorageChartView"
          height: 120
          content:
            - chart_type: "pie"
            - segments:
                - label: "本地缓存"
                  color: "systemBlue"
                  value: "{localSize}"
                - label: "可用空间"
                  color: "systemGray"
                  value: "{freeSpace}"

        - id: "storage_stats"
          type: "info_grid"
          columns: 2
          items:
            - { label: "总文件数", value: "{totalFiles}" }
            - { label: "本地缓存", value: "{localSize}" }
            - { label: "脏文件数", value: "{dirtyFiles}" }
            - { label: "可用空间", value: "{freeSpace}" }

    - id: "eviction"
      title: "自动清理"
      items:
        - id: "auto_eviction"
          type: "toggle"
          label: "启用自动清理"
          description: "当本地空间不足时自动清理缓存"
          default: true
          binding: "config.autoEviction"

        - id: "eviction_threshold"
          type: "slider"
          label: "空间阈值"
          description: "可用空间低于此值时触发清理"
          enabled_when: "config.autoEviction"
          min: 1
          max: 50
          unit: "GB"
          default: 10
          binding: "config.evictionThreshold"

        - id: "keep_days"
          type: "stepper"
          label: "最少保留天数"
          description: "最近访问的文件不会被清理"
          enabled_when: "config.autoEviction"
          min: 1
          max: 30
          unit: "天"
          default: 7
          binding: "config.evictionKeepDays"

    - id: "manual_actions"
      title: "手动操作"
      items:
        - id: "clear_cache"
          type: "button"
          label: "清理所有缓存"
          style: "destructive"
          confirm:
            title: "确认清理缓存?"
            message: "这将删除所有本地缓存文件，但不会影响外置磁盘上的数据。"
            confirm_button: "清理"
            cancel_button: "取消"
          action: "clearAllCache"
```

### 5.5 磁盘设置页

```yaml
disks_tab:
  sections:
    - id: "configured_disks"
      title: "已配置的磁盘"
      items:
        - id: "disk_list"
          type: "list"
          style: "source_list"
          item_height: 56
          empty_state:
            icon: "externaldrive.badge.plus"
            message: "尚未配置任何磁盘"
            action: "添加磁盘"

          item_template:
            layout: "horizontal"
            components:
              - type: "icon"
                icon: "externaldrive.fill"
                size: 32
                color_binding: "disk.isOnline ? systemBlue : systemGray"

              - type: "vstack"
                spacing: 2
                content:
                  - type: "text"
                    text_binding: "disk.name"
                    font: "title3"

                  - type: "text"
                    text_binding: "disk.statusText"
                    font: "caption"
                    color: "secondaryLabelColor"

              - type: "spacer"

              - type: "badge"
                visible_when: "disk.isOnline"
                text: "已连接"
                color: "systemGreen"

            context_menu:
              - { title: "查看详情", action: "viewDiskDetails" }
              - { type: "separator" }
              - { title: "编辑配置", action: "editDiskConfig" }
              - { title: "立即同步", action: "syncDisk", enabled: "disk.isOnline" }
              - { type: "separator" }
              - { title: "移除磁盘", action: "removeDisk", style: "destructive" }

    - id: "actions"
      title: null
      items:
        - id: "add_disk"
          type: "button"
          label: "添加磁盘..."
          icon: "plus"
          action: "showAddDiskSheet"
```

### 5.6 高级设置页

```yaml
advanced_tab:
  sections:
    - id: "maintenance"
      title: "维护"
      items:
        - id: "rebuild_index"
          type: "button"
          label: "重建索引"
          description: "如果文件列表不正确，可尝试重建索引"
          icon: "arrow.clockwise"
          confirm:
            title: "确认重建索引?"
            message: "这将扫描所有同步目录并重建文件索引，可能需要几分钟时间。"
          action: "rebuildIndex"

        - id: "reset_config"
          type: "button"
          label: "重置所有设置"
          description: "恢复默认配置，不影响已同步的文件"
          icon: "arrow.uturn.backward"
          style: "destructive"
          confirm:
            title: "确认重置设置?"
            message: "所有设置将恢复为默认值，但不会删除任何文件。"
          action: "resetConfig"

    - id: "diagnostics"
      title: "诊断"
      items:
        - id: "diagnostic_info"
          type: "info_panel"
          content:
            - { label: "App 版本", value: "{appVersion}" }
            - { label: "Service 版本", value: "{serviceVersion}" }
            - { label: "macFUSE 版本", value: "{fuseVersion}" }
            - { label: "数据库大小", value: "{databaseSize}" }

        - id: "export_logs"
          type: "button"
          label: "导出诊断日志"
          icon: "square.and.arrow.up"
          action: "exportDiagnostics"

        - id: "open_support_folder"
          type: "button"
          label: "打开支持文件夹"
          icon: "folder"
          action: "openSupportFolder"
```

---

## 六、同步详情窗口

### 6.1 窗口规范

```yaml
sync_detail_window:
  dimensions:
    width: 450
    height: 350
    min_width: 400
    min_height: 300
    resizable: true

  style:
    type: "panel"
    title: "同步详情"
    floating: true

  layout:
    sections:
      - id: "header"
      - id: "progress"
      - id: "stats"
      - id: "current_file"
      - id: "errors"
      - id: "actions"
```

### 6.2 同步头部

```yaml
sync_header:
  layout:
    padding: { top: 20, bottom: 12, horizontal: 24 }

  components:
    - type: "hstack"
      alignment: "center"
      spacing: 12

      content:
        - type: "icon"
          icon_binding: "sync.statusIcon"
          size: 32
          color_binding: "sync.statusColor"
          animation_binding: "sync.iconAnimation"

        - type: "vstack"
          spacing: 2
          content:
            - type: "text"
              text_binding: "sync.statusTitle"
              font: "title2"

            - type: "text"
              text_binding: "sync.statusSubtitle"
              font: "callout"
              color: "secondaryLabelColor"

  status_mapping:
    preparing:
      icon: "hourglass"
      color: "systemYellow"
      title: "准备同步..."
      subtitle: "扫描文件中"

    syncing:
      icon: "arrow.clockwise"
      color: "systemBlue"
      animation: "rotate"
      title: "同步中"
      subtitle_binding: "{processedFiles}/{totalFiles} 文件"

    paused:
      icon: "pause.circle.fill"
      color: "systemOrange"
      title: "已暂停"
      subtitle: "点击继续"

    completed:
      icon: "checkmark.circle.fill"
      color: "systemGreen"
      title: "同步完成"
      subtitle_binding: "已同步 {totalFiles} 个文件"

    failed:
      icon: "xmark.circle.fill"
      color: "systemRed"
      title: "同步失败"
      subtitle_binding: "{failedFiles} 个文件失败"
```

### 6.3 进度条区域

```yaml
sync_progress:
  layout:
    padding: { top: 0, bottom: 16, horizontal: 24 }

  components:
    - type: "progress_bar"
      progress_binding: "sync.progress"
      style: "linear"
      height: 6
      corner_radius: 3
      background_color: "separatorColor"
      fill_color: "controlAccentColor"

    - type: "spacer"
      height: 8

    - type: "hstack"
      content:
        - type: "text"
          text_binding: "{sync.progressPercent}%"
          font: "caption"
          color: "secondaryLabelColor"

        - type: "spacer"

        - type: "text"
          text_binding: "剩余 {sync.estimatedTime}"
          font: "caption"
          color: "secondaryLabelColor"
          visible_when: "sync.estimatedTime != nil"
```

### 6.4 统计信息

```yaml
sync_stats:
  layout:
    type: "grid"
    columns: 2
    padding: { top: 0, bottom: 16, horizontal: 24 }
    row_spacing: 8
    column_spacing: 24

  items:
    - label: "已处理"
      value_binding: "{sync.processedFiles} / {sync.totalFiles}"
      icon: "doc"

    - label: "已传输"
      value_binding: "{sync.transferredSize}"
      icon: "arrow.up.arrow.down"

    - label: "传输速度"
      value_binding: "{sync.speed}/s"
      icon: "speedometer"

    - label: "剩余时间"
      value_binding: "{sync.estimatedTime}"
      icon: "clock"
```

### 6.5 当前文件

```yaml
current_file:
  layout:
    padding: { top: 0, bottom: 16, horizontal: 24 }
    visible_when: "sync.currentFile != nil"

  components:
    - type: "section_header"
      title: "当前文件"

    - type: "file_item"
      layout:
        padding: { vertical: 8, horizontal: 12 }
        background: "controlBackgroundColor"
        corner_radius: 6

      components:
        - type: "hstack"
          spacing: 8

          content:
            - type: "file_icon"
              extension_binding: "sync.currentFile.extension"
              size: 24

            - type: "vstack"
              spacing: 2
              content:
                - type: "text"
                  text_binding: "sync.currentFile.name"
                  font: "body"
                  line_limit: 1
                  truncation: "middle"

                - type: "text"
                  text_binding: "sync.currentFile.path"
                  font: "caption"
                  color: "tertiaryLabelColor"
                  line_limit: 1
                  truncation: "head"

            - type: "spacer"

            - type: "text"
              text_binding: "sync.currentFile.size"
              font: "caption"
              color: "secondaryLabelColor"
```

### 6.6 错误列表

```yaml
error_list:
  layout:
    padding: { top: 0, bottom: 16, horizontal: 24 }
    visible_when: "sync.errors.count > 0"
    max_height: 120

  components:
    - type: "section_header"
      title: "失败的文件"
      badge: "{sync.errors.count}"
      badge_color: "systemRed"

    - type: "scrollable_list"
      item_height: 36

      item_template:
        layout:
          padding: { vertical: 6, horizontal: 8 }

        components:
          - type: "hstack"
            spacing: 8
            content:
              - type: "icon"
                icon: "xmark.circle.fill"
                size: 16
                color: "systemRed"

              - type: "vstack"
                spacing: 1
                content:
                  - type: "text"
                    text_binding: "error.fileName"
                    font: "callout"
                    line_limit: 1

                  - type: "text"
                    text_binding: "error.reason"
                    font: "caption"
                    color: "systemRed"
                    line_limit: 1
```

### 6.7 操作按钮

```yaml
sync_actions:
  layout:
    padding: { top: 0, bottom: 20, horizontal: 24 }
    alignment: "center"

  components:
    - type: "hstack"
      spacing: 12

      content:
        - type: "button"
          title_binding: "sync.isPaused ? '继续' : '暂停'"
          icon_binding: "sync.isPaused ? 'play.fill' : 'pause.fill'"
          style: "secondary"
          visible_when: "sync.isActive"
          action_binding: "sync.isPaused ? resumeSync : pauseSync"

        - type: "button"
          title: "取消"
          icon: "xmark"
          style: "secondary"
          visible_when: "sync.isActive"
          action: "cancelSync"
          confirm:
            title: "确认取消同步?"
            message: "已同步的文件将保留"

        - type: "button"
          title: "关闭"
          style: "primary"
          visible_when: "!sync.isActive"
          action: "closeWindow"
```

---

## 七、冲突解决界面

### 7.1 冲突列表窗口

```yaml
conflict_list_window:
  dimensions:
    width: 600
    height: 450
    min_width: 500
    min_height: 350

  style:
    type: "document"
    title: "文件冲突"

  toolbar:
    items:
      - id: "resolve_all"
        title: "全部解决"
        icon: "checkmark.circle"
        menu:
          - { title: "保留所有本地版本", action: "resolveAllLocal" }
          - { title: "保留所有外部版本", action: "resolveAllExternal" }
          - { title: "保留所有两者", action: "resolveAllBoth" }

      - type: "flexible_space"

      - id: "filter"
        type: "search"
        placeholder: "搜索冲突文件..."
```

### 7.2 冲突列表

```yaml
conflict_list:
  layout:
    type: "table"
    selection: "multiple"

  columns:
    - id: "file"
      title: "文件"
      width: { min: 200, max: 400, default: 250 }

    - id: "local_modified"
      title: "本地修改时间"
      width: { default: 140 }

    - id: "external_modified"
      title: "外部修改时间"
      width: { default: 140 }

    - id: "action"
      title: ""
      width: { fixed: 100 }

  row_template:
    height: 48

    file_column:
      components:
        - type: "hstack"
          spacing: 8
          content:
            - type: "file_icon"
              extension_binding: "conflict.extension"
              size: 24

            - type: "vstack"
              spacing: 1
              content:
                - type: "text"
                  text_binding: "conflict.fileName"
                  font: "body"

                - type: "text"
                  text_binding: "conflict.relativePath"
                  font: "caption"
                  color: "tertiaryLabelColor"

    date_column:
      components:
        - type: "text"
          text_binding: "conflict.localModified"
          font: "callout"

    action_column:
      components:
        - type: "button"
          title: "解决"
          style: "inline"
          action: "showResolvePopover"

  empty_state:
    icon: "checkmark.seal"
    title: "没有冲突"
    message: "所有文件都已同步"

  context_menu:
    - { title: "在 Finder 中显示本地文件", action: "revealLocalInFinder" }
    - { title: "在 Finder 中显示外部文件", action: "revealExternalInFinder" }
    - { type: "separator" }
    - { title: "保留本地版本", action: "resolveKeepLocal" }
    - { title: "保留外部版本", action: "resolveKeepExternal" }
    - { title: "保留两者", action: "resolveKeepBoth" }
```

### 7.3 冲突解决弹出框

```yaml
resolve_popover:
  dimensions:
    width: 320
    padding: 16

  components:
    - type: "header"
      title: "解决冲突"
      subtitle_binding: "conflict.fileName"

    - type: "spacer"
      height: 12

    - type: "comparison_view"
      layout:
        type: "horizontal"
        spacing: 12

      local_side:
        title: "本地版本"
        icon: "laptopcomputer"
        color: "systemBlue"
        details:
          - { label: "大小", value_binding: "conflict.localSize" }
          - { label: "修改时间", value_binding: "conflict.localModified" }

      external_side:
        title: "外部版本"
        icon: "externaldrive"
        color: "systemOrange"
        details:
          - { label: "大小", value_binding: "conflict.externalSize" }
          - { label: "修改时间", value_binding: "conflict.externalModified" }

    - type: "spacer"
      height: 16

    - type: "radio_group"
      binding: "selectedResolution"
      options:
        - id: "keep_local"
          title: "保留本地版本"
          description: "删除外部版本"

        - id: "keep_external"
          title: "保留外部版本"
          description: "删除本地版本"

        - id: "keep_both"
          title: "保留两者"
          description: "重命名其中一个文件"

    - type: "spacer"
      height: 16

    - type: "hstack"
      alignment: "trailing"
      spacing: 8
      content:
        - type: "button"
          title: "取消"
          style: "secondary"
          action: "dismissPopover"

        - type: "button"
          title: "解决"
          style: "primary"
          action: "resolveConflict"
```

---

## 八、磁盘管理界面

### 8.1 磁盘管理窗口

```yaml
disk_management_window:
  dimensions:
    width: 550
    height: 400
    min_width: 450
    min_height: 350

  style:
    type: "document"
    title: "磁盘管理"

  layout:
    type: "source_list"
    sidebar_width: 180
```

### 8.2 磁盘侧边栏

```yaml
disk_sidebar:
  header:
    title: "已配置的磁盘"
    action:
      icon: "plus"
      tooltip: "添加磁盘"
      action: "showAddDiskSheet"

  list:
    item_height: 44

    item_template:
      components:
        - type: "hstack"
          spacing: 8
          content:
            - type: "circle_indicator"
              size: 8
              color_binding: "disk.isOnline ? systemGreen : systemGray"

            - type: "icon"
              icon: "externaldrive.fill"
              size: 20
              color_binding: "disk.isOnline ? labelColor : tertiaryLabelColor"

            - type: "vstack"
              spacing: 1
              content:
                - type: "text"
                  text_binding: "disk.name"
                  font: "body"

                - type: "text"
                  text_binding: "disk.isOnline ? disk.mountPath : '未连接'"
                  font: "caption"
                  color: "secondaryLabelColor"

    selection_style: "sidebar"
```

### 8.3 磁盘详情面板

```yaml
disk_detail_panel:
  layout:
    padding: 24

  sections:
    - id: "status"
      components:
        - type: "hstack"
          spacing: 16
          content:
            - type: "icon"
              icon: "externaldrive.fill"
              size: 48
              color_binding: "disk.isOnline ? systemBlue : systemGray"

            - type: "vstack"
              spacing: 4
              content:
                - type: "text"
                  text_binding: "disk.name"
                  font: "title1"

                - type: "badge"
                  text_binding: "disk.isOnline ? '已连接' : '未连接'"
                  color_binding: "disk.isOnline ? systemGreen : systemGray"

    - id: "info"
      title: "磁盘信息"
      margin_top: 24

      items:
        - type: "info_row"
          label: "挂载路径"
          value_binding: "disk.mountPath ?? '—'"

        - type: "info_row"
          label: "同步目录"
          value_binding: "disk.externalDir"

        - type: "info_row"
          label: "目标目录"
          value_binding: "disk.targetDir"

        - type: "info_row"
          label: "文件数量"
          value_binding: "{disk.fileCount} 个文件"

        - type: "info_row"
          label: "总大小"
          value_binding: "disk.totalSize"

        - type: "info_row"
          label: "上次同步"
          value_binding: "disk.lastSyncTime ?? '从未'"

    - id: "storage"
      title: "存储空间"
      margin_top: 24
      visible_when: "disk.isOnline"

      components:
        - type: "storage_bar"
          used_binding: "disk.usedSpace"
          total_binding: "disk.totalSpace"
          segments:
            - label: "同步文件"
              color: "systemBlue"
              value_binding: "disk.syncFilesSize"
            - label: "其他文件"
              color: "systemGray"
              value_binding: "disk.otherFilesSize"
            - label: "可用空间"
              color: "systemGray2"
              value_binding: "disk.freeSpace"

    - id: "actions"
      margin_top: 24

      components:
        - type: "hstack"
          spacing: 12
          content:
            - type: "button"
              title: "立即同步"
              icon: "arrow.clockwise"
              style: "secondary"
              enabled_binding: "disk.isOnline"
              action: "syncDisk"

            - type: "button"
              title: "编辑配置"
              icon: "pencil"
              style: "secondary"
              action: "editDiskConfig"

            - type: "spacer"

            - type: "button"
              title: "移除"
              style: "destructive"
              action: "removeDisk"
              confirm:
                title: "确认移除磁盘?"
                message: "移除配置不会删除磁盘上的文件"
```

### 8.4 添加磁盘表单

```yaml
add_disk_sheet:
  dimensions:
    width: 450
    height: 380

  style:
    type: "sheet"
    title: "添加磁盘"

  components:
    - type: "form"
      padding: 24
      spacing: 16

      fields:
        - id: "disk_selector"
          type: "disk_picker"
          label: "选择磁盘"
          description: "选择要添加的外置磁盘"
          filter: "external_only"
          exclude: "already_configured"
          binding: "newDisk.disk"

        - id: "name"
          type: "text_field"
          label: "显示名称"
          placeholder: "例如: 我的备份盘"
          binding: "newDisk.name"
          validation:
            required: true
            max_length: 50

        - id: "external_dir"
          type: "path_picker"
          label: "同步目录"
          description: "磁盘上用于存储同步文件的目录"
          mode: "directory"
          base_path_binding: "newDisk.disk.mountPath"
          binding: "newDisk.externalDir"

        - id: "target_dir"
          type: "path_picker"
          label: "目标目录"
          description: "本地虚拟目录路径"
          mode: "directory"
          default: "~/Downloads"
          binding: "newDisk.targetDir"

    - type: "spacer"

    - type: "hstack"
      padding: { horizontal: 24, bottom: 24 }
      alignment: "trailing"
      spacing: 12

      content:
        - type: "button"
          title: "取消"
          style: "secondary"
          action: "dismissSheet"

        - type: "button"
          title: "添加"
          style: "primary"
          enabled_binding: "newDisk.isValid"
          action: "addDisk"
```

---

## 九、弹窗与通知

### 9.1 确认对话框

```yaml
confirmation_dialogs:
  # 通用确认对话框模板
  template:
    width: 300
    style: "alert"

    components:
      - type: "icon"
        icon_binding: "dialog.icon"
        size: 48
        color_binding: "dialog.iconColor"
        alignment: "center"

      - type: "spacer"
        height: 16

      - type: "text"
        text_binding: "dialog.title"
        font: "title2"
        alignment: "center"

      - type: "spacer"
        height: 8

      - type: "text"
        text_binding: "dialog.message"
        font: "body"
        color: "secondaryLabelColor"
        alignment: "center"
        multiline: true

      - type: "spacer"
        height: 20

      - type: "hstack"
        spacing: 12
        alignment: "center"

        content:
          - type: "button"
            title_binding: "dialog.cancelTitle"
            style: "secondary"
            action: "cancel"

          - type: "button"
            title_binding: "dialog.confirmTitle"
            style_binding: "dialog.isDestructive ? 'destructive' : 'primary'"
            action: "confirm"

  # 具体对话框定义
  dialogs:
    quit_with_sync:
      icon: "arrow.clockwise"
      icon_color: "systemBlue"
      title: "同步正在进行中"
      message: "退出将取消当前同步操作。已同步的文件将保留。"
      cancel_title: "取消"
      confirm_title: "退出"
      is_destructive: false
      options:
        - id: "wait"
          title: "等待完成"
          description: "同步完成后自动退出"

    delete_disk:
      icon: "externaldrive.badge.minus"
      icon_color: "systemRed"
      title: "移除磁盘配置?"
      message: "这将停止此磁盘的同步，但不会删除磁盘上的文件。"
      cancel_title: "取消"
      confirm_title: "移除"
      is_destructive: true

    clear_cache:
      icon: "trash"
      icon_color: "systemRed"
      title: "清理所有缓存?"
      message: "这将删除所有本地缓存文件。外置磁盘上的原始文件不受影响。"
      cancel_title: "取消"
      confirm_title: "清理"
      is_destructive: true

    rebuild_index:
      icon: "arrow.clockwise"
      icon_color: "systemOrange"
      title: "重建索引?"
      message: "这将扫描所有同步目录并重建文件索引。此操作可能需要几分钟。"
      cancel_title: "取消"
      confirm_title: "重建"
      is_destructive: false
```

### 9.2 错误弹窗

```yaml
error_alerts:
  styles:
    critical:
      icon: "xmark.octagon.fill"
      icon_color: "systemRed"
      show_help_button: true

    warning:
      icon: "exclamationmark.triangle.fill"
      icon_color: "systemYellow"
      show_help_button: false

    info:
      icon: "info.circle.fill"
      icon_color: "systemBlue"
      show_help_button: false

  templates:
    connection_failed:
      style: "critical"
      title: "无法连接到后台服务"
      message: "DMSA 后台服务未响应。请检查服务是否正在运行。"
      actions:
        - title: "重试"
          action: "retryConnection"
          style: "primary"
        - title: "查看帮助"
          action: "openHelp"
          style: "secondary"
      help_url: "https://help.dmsa.app/connection"

    disk_full:
      style: "critical"
      title: "磁盘空间不足"
      message: "本地磁盘空间不足，无法完成同步。请清理空间或启用自动缓存管理。"
      actions:
        - title: "清理缓存"
          action: "clearCache"
          style: "primary"
        - title: "打开设置"
          action: "openStorageSettings"
          style: "secondary"

    sync_failed:
      style: "warning"
      title: "同步失败"
      message_binding: "{failedCount} 个文件同步失败。"
      actions:
        - title: "查看详情"
          action: "showSyncDetails"
          style: "primary"
        - title: "忽略"
          action: "dismiss"
          style: "secondary"

    permission_denied:
      style: "critical"
      title: "权限不足"
      message: "DMSA 没有访问所需文件的权限。请在系统偏好设置中授予完全磁盘访问权限。"
      actions:
        - title: "打开设置"
          action: "openPermissionSettings"
          style: "primary"
        - title: "稍后"
          action: "dismiss"
          style: "secondary"
```

### 9.3 系统通知

```yaml
system_notifications:
  categories:
    sync:
      identifier: "SYNC_NOTIFICATIONS"
      actions:
        - id: "view"
          title: "查看"
          options: ["foreground"]

    conflict:
      identifier: "CONFLICT_NOTIFICATIONS"
      actions:
        - id: "resolve"
          title: "解决"
          options: ["foreground"]
        - id: "later"
          title: "稍后"
          options: []

    error:
      identifier: "ERROR_NOTIFICATIONS"
      actions:
        - id: "view"
          title: "查看详情"
          options: ["foreground"]

  templates:
    sync_completed:
      category: "sync"
      title: "同步完成"
      body: "已同步 {fileCount} 个文件到 {diskName}"
      sound: "default"
      badge: null

    conflict_detected:
      category: "conflict"
      title: "检测到文件冲突"
      body: "{fileName} 在本地和外部磁盘上都有修改"
      sound: "default"
      badge: "+1"

    disk_disconnected:
      category: "error"
      title: "磁盘已断开"
      body: "{diskName} 已断开连接"
      sound: null
      badge: null

    error_occurred:
      category: "error"
      title: "发生错误"
      body: "{errorMessage}"
      sound: "default"
      badge: null
```

---

## 十、响应式设计

### 10.1 窗口尺寸适配

```yaml
responsive_design:
  breakpoints:
    compact:
      max_width: 400
    regular:
      min_width: 401
      max_width: 600
    expanded:
      min_width: 601

  settings_window:
    compact:
      layout: "stacked_tabs"
      tab_position: "top"
    regular:
      layout: "sidebar"
      sidebar_width: 150
    expanded:
      layout: "sidebar"
      sidebar_width: 180

  conflict_window:
    compact:
      columns: ["file", "action"]
      hide_columns: ["local_modified", "external_modified"]
    regular:
      columns: "all"

  disk_management:
    compact:
      layout: "list_only"
      detail_style: "navigation"
    regular:
      layout: "master_detail"
      sidebar_width: 200
```

### 10.2 文本截断策略

```yaml
text_truncation:
  file_names:
    max_length: 40
    truncation: "middle"
    tooltip: "full_text"

  file_paths:
    max_length: 60
    truncation: "head"
    tooltip: "full_text"

  error_messages:
    max_lines: 3
    truncation: "tail"
    expandable: true
```

---

## 十一、无障碍设计

### 11.1 VoiceOver 支持

```yaml
accessibility:
  voiceover:
    status_bar:
      label: "DMSA 状态"
      value_binding: "uiState.accessibilityLabel"
      hint: "点击打开菜单"
      traits: ["button"]

    menu_items:
      sync_now:
        label: "立即同步"
        hint: "开始同步文件到外置磁盘"
        traits: ["button"]

      conflict_badge:
        label_binding: "{conflictCount} 个待解决的冲突"

    progress:
      label_binding: "同步进度 {progress} 百分比"
      traits: ["updatesFrequently"]

  reduce_motion:
    enabled_check: "NSReduceMotionEnabled"
    alternatives:
      rotating_icon: "static_icon"
      pulse_animation: "opacity_change"
      slide_transition: "fade_transition"

  increase_contrast:
    enabled_check: "NSIncreaseContrastEnabled"
    adjustments:
      border_width: "+1"
      text_color: "black_or_white"
      separator_opacity: 1.0
```

### 11.2 键盘导航

```yaml
keyboard_navigation:
  global_shortcuts:
    - keys: "⌘,"
      action: "openSettings"
      scope: "app"

    - keys: "⌘S"
      action: "syncNow"
      scope: "menu"

    - keys: "⌘K"
      action: "openConflicts"
      scope: "menu"

    - keys: "⌘D"
      action: "openDiskManagement"
      scope: "menu"

    - keys: "⌘Q"
      action: "quit"
      scope: "app"

  tab_order:
    settings_window:
      - "tab_bar"
      - "form_fields"
      - "action_buttons"

    conflict_window:
      - "search_field"
      - "conflict_list"
      - "resolve_button"

  focus_ring:
    style: "system"
    visible_when: "keyboard_navigation_active"
```

---

## 十二、组件规范

### 12.1 按钮样式

```yaml
button_styles:
  primary:
    background: "controlAccentColor"
    text_color: "white"
    corner_radius: 6
    padding: { horizontal: 16, vertical: 8 }
    font: "body"
    font_weight: "medium"
    min_width: 80

    states:
      normal: {}
      hover:
        background: "controlAccentColor.darker(10%)"
      pressed:
        background: "controlAccentColor.darker(20%)"
      disabled:
        background: "systemGray4"
        text_color: "systemGray"
        opacity: 0.6

  secondary:
    background: "controlBackgroundColor"
    text_color: "labelColor"
    border: "1px solid separatorColor"
    corner_radius: 6
    padding: { horizontal: 16, vertical: 8 }

    states:
      hover:
        background: "controlBackgroundColor.darker(5%)"
      pressed:
        background: "controlBackgroundColor.darker(10%)"

  destructive:
    background: "systemRed"
    text_color: "white"
    corner_radius: 6
    padding: { horizontal: 16, vertical: 8 }

    states:
      hover:
        background: "systemRed.darker(10%)"

  inline:
    background: "transparent"
    text_color: "controlAccentColor"
    padding: { horizontal: 8, vertical: 4 }
    font: "callout"

    states:
      hover:
        background: "controlAccentColor.opacity(0.1)"
```

### 12.2 表单控件

```yaml
form_controls:
  text_field:
    height: 28
    padding: { horizontal: 8, vertical: 4 }
    background: "controlBackgroundColor"
    border: "1px solid separatorColor"
    corner_radius: 4
    font: "body"

    states:
      focused:
        border: "2px solid controlAccentColor"
      error:
        border: "1px solid systemRed"

  toggle:
    width: 42
    height: 24
    animation_duration: 0.2

  slider:
    track_height: 4
    thumb_size: 18
    track_color: "separatorColor"
    fill_color: "controlAccentColor"

  dropdown:
    height: 28
    padding: { horizontal: 8, vertical: 4 }
    arrow_icon: "chevron.down"
    arrow_size: 10

  stepper:
    button_width: 24
    input_width: 60
```

### 12.3 列表样式

```yaml
list_styles:
  standard:
    row_height: 44
    separator: true
    separator_inset: { left: 16 }

  source_list:
    row_height: 32
    separator: false
    selection_style: "rounded"
    padding: { horizontal: 8 }

  grouped:
    section_header_height: 28
    section_header_font: "caption"
    section_header_color: "secondaryLabelColor"
    section_spacing: 16
```

### 12.4 进度指示器

```yaml
progress_indicators:
  linear:
    height: 6
    corner_radius: 3
    background: "separatorColor"
    fill: "controlAccentColor"
    animation: "smooth"

  circular:
    size: { small: 16, medium: 24, large: 32 }
    stroke_width: 2
    animation: "rotate"

  indeterminate:
    type: "bar"
    animation: "shimmer"
    duration: 1.5
```

---

## 附录

### A. 设计检查清单

```yaml
design_checklist:
  visual:
    - "使用系统语义颜色"
    - "适配深色模式"
    - "图标使用 SF Symbols"
    - "间距遵循 4px 网格"
    - "字体使用系统字体"

  interaction:
    - "每个操作有即时反馈"
    - "破坏性操作需确认"
    - "提供键盘快捷键"
    - "长时操作可取消"

  accessibility:
    - "VoiceOver 标签完整"
    - "支持键盘导航"
    - "支持减少动画"
    - "对比度符合 WCAG AA"

  performance:
    - "列表使用虚拟化"
    - "图片延迟加载"
    - "动画使用 GPU 加速"
```

### B. 颜色对照表

| 用途 | 浅色模式 | 深色模式 |
|------|----------|----------|
| 主要文字 | #000000D9 | #FFFFFFD9 |
| 次要文字 | #0000008C | #FFFFFF8C |
| 主色调 | #007AFF | #0A84FF |
| 成功 | #34C759 | #30D158 |
| 警告 | #FF9500 | #FF9F0A |
| 错误 | #FF3B30 | #FF453A |

### C. 图标参考

| 功能 | SF Symbol |
|------|-----------|
| 同步 | arrow.clockwise |
| 设置 | gear |
| 磁盘 | externaldrive |
| 冲突 | exclamationmark.2 |
| 成功 | checkmark.circle.fill |
| 错误 | xmark.circle.fill |
| 添加 | plus |
| 删除 | trash |

---

*文档版本: 1.0 | 最后更新: 2026-01-27*
