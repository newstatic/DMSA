# Delt MACOS Sync App (DMSA) UI/UX 设计文档

> 版本: 3.0 | 更新日期: 2026-01-21

---

## 目录

1. [设计原则](#1-设计原则)
2. [界面概览](#2-界面概览)
3. [菜单栏界面](#3-菜单栏界面)
4. [主窗口设计](#4-主窗口设计)
5. [设置窗口](#5-设置窗口)
6. [同步进度窗口](#6-同步进度窗口)
7. [历史记录窗口](#7-历史记录窗口)
8. [首次启动向导](#8-首次启动向导)
9. [通知设计](#9-通知设计)
10. [错误与恢复界面](#10-错误与恢复界面)
11. [深色模式适配](#11-深色模式适配)
12. [交互动画](#12-交互动画)
13. [键盘快捷键](#13-键盘快捷键)
14. [无障碍设计](#14-无障碍设计)
15. [SwiftUI 组件规范](#15-swiftui-组件规范)

---

## 1. 设计原则

### 1.1 核心理念

| 原则 | 说明 |
|------|------|
| **简洁优先** | 菜单栏应用应尽量隐形，只在需要时出现 |
| **状态可见** | 用户随时了解同步状态，无需打开窗口 |
| **操作直观** | 常用操作一键可达，复杂设置分层展示 |
| **原生体验** | 遵循 macOS Human Interface Guidelines |
| **渐进披露** | 高级功能不干扰普通用户 |

### 1.2 设计规范

```
字体: SF Pro (系统默认)
主色调: 系统蓝 (AccentColor)
成功色: 系统绿 (#34C759)
警告色: 系统橙 (#FF9500)
错误色: 系统红 (#FF3B30)
圆角: 8pt (窗口), 6pt (按钮), 4pt (输入框)
间距: 8pt 基准网格
```

### 1.3 用户画像

| 用户类型 | 需求 | UI 重点 |
|----------|------|---------|
| 普通用户 | 插拔硬盘自动同步 | 状态清晰、通知及时 |
| 高级用户 | 多硬盘、多目录、自定义规则 | 设置灵活、信息详尽 |
| 开发者 | 查看日志、调试问题 | 日志便捷、错误详细 |

---

## 2. 界面概览

### 2.1 界面层级

```
┌─────────────────────────────────────────────────────────────────────┐
│                           界面层级结构                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Level 0: 菜单栏图标                                                  │
│  ┌─────┐                                                             │
│  │ 🔄  │ ← 常驻，显示状态                                              │
│  └─────┘                                                             │
│      │                                                               │
│      ▼                                                               │
│  Level 1: 下拉菜单                                                    │
│  ┌─────────────────────┐                                             │
│  │ 状态信息             │ ← 快速查看，常用操作                          │
│  │ 快捷操作             │                                             │
│  │ 设置/退出            │                                             │
│  └─────────────────────┘                                             │
│      │                                                               │
│      ▼                                                               │
│  Level 2: 独立窗口                                                    │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐            │
│  │  设置窗口  │ │  进度窗口  │ │  历史窗口  │ │  向导窗口  │            │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘            │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.2 窗口尺寸规范

| 窗口 | 默认尺寸 | 最小尺寸 | 可调整 |
|------|----------|----------|--------|
| 设置窗口 | 600 × 500 | 500 × 400 | 是 |
| 进度窗口 | 400 × 150 | 350 × 120 | 否 |
| 历史窗口 | 700 × 500 | 500 × 300 | 是 |
| 首次向导 | 600 × 450 | - | 否 |

---

## 3. 菜单栏界面

### 3.1 图标状态

```
┌─────────────────────────────────────────────────────────────────────┐
│                         菜单栏图标状态                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  状态            图标                    说明                         │
│  ─────────────────────────────────────────────────────────────────  │
│                                                                      │
│  未连接          ○─────○                灰色双箭头                    │
│                  ↺                       (SF: arrow.triangle.2       │
│                                          .circlepath)                │
│                                                                      │
│  已连接          ●─────●                蓝色实心双箭头                 │
│  (空闲)          ↺                       (SF: arrow.triangle.2       │
│                                          .circlepath.circle.fill)   │
│                                                                      │
│  同步中          ◐─────◐                动画旋转                      │
│                  ↻ (旋转)                (SF: arrow.triangle.2       │
│                                          .circlepath.circle)        │
│                                                                      │
│  有错误          ⚠                       黄色警告三角                  │
│                                          (SF: exclamationmark        │
│                                          .triangle.fill)            │
│                                                                      │
│  脏数据          ●─────●                蓝色 + 小圆点标记              │
│  待同步          ↺ •                     表示有待同步数据              │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 下拉菜单布局

```
┌─────────────────────────────────────────┐
│  DMSA                                   │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐    │
│  │ 🟢  BACKUP 已连接                │    │  ← 硬盘状态区
│  │     450 GB / 1 TB (45%)         │    │
│  │     上次同步: 5 分钟前           │    │
│  └─────────────────────────────────┘    │
│                                         │
│  ┌─────────────────────────────────┐    │
│  │ ⚪  PORTABLE 未连接              │    │
│  └─────────────────────────────────┘    │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  📁 Downloads → BACKUP/Downloads    ✓   │  ← 同步对状态
│  📁 Documents → BACKUP/Documents    ✓   │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  🔄 立即同步                       ⌘S   │  ← 操作区
│  📂 打开 Downloads                 ⌘O   │
│  📋 查看日志                       ⌘L   │
│  📊 同步历史                       ⌘H   │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  ⚙️ 设置...                        ⌘,   │  ← 设置区
│  ℹ️ 关于 DMSA                           │
│  ⏻ 退出                           ⌘Q   │
│                                         │
└─────────────────────────────────────────┘
```

### 3.3 菜单项详细规格

| 区域 | 菜单项 | 快捷键 | 状态 | 说明 |
|------|--------|--------|------|------|
| **状态区** | 硬盘状态卡片 | - | 禁用 | 显示连接状态、容量、上次同步 |
| | 同步对状态 | - | 禁用 | 显示同步方向和状态图标 |
| **操作区** | 立即同步 | ⌘S | 条件启用 | 硬盘连接时启用 |
| | 打开 Downloads | ⌘O | 始终启用 | 打开 Finder |
| | 查看日志 | ⌘L | 始终启用 | 在控制台打开 |
| | 同步历史 | ⌘H | 始终启用 | 打开历史窗口 |
| **设置区** | 设置... | ⌘, | 始终启用 | 打开设置窗口 |
| | 关于 DMSA | - | 始终启用 | 显示版本信息 |
| | 退出 | ⌘Q | 始终启用 | 退出应用 |

---

## 4. 主窗口设计

DMSA 作为菜单栏应用，没有传统主窗口。用户交互主要通过：
- 菜单栏下拉菜单
- 设置窗口
- 进度窗口
- 历史窗口

---

## 5. 设置窗口

### 5.1 窗口布局

```
┌─────────────────────────────────────────────────────────────────────┐
│  ⚙️ DMSA 设置                                          ─  □  ✕     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────┐  ┌────────────────────────────────────────────┐   │
│  │              │  │                                            │   │
│  │  🖥 通用      │  │  通用设置                                  │   │
│  │              │  │  ─────────────────────────────────────     │   │
│  │  💾 硬盘      │  │                                            │   │
│  │              │  │  □ 登录时启动                               │   │
│  │  📁 同步对    │  │                                            │   │
│  │              │  │  □ 在 Dock 中显示图标                       │   │
│  │  🚫 过滤规则  │  │                                            │   │
│  │              │  │  □ 自动检查更新                             │   │
│  │  💾 缓存      │  │                                            │   │
│  │              │  │  语言: [系统默认        ▼]                   │   │
│  │  🔔 通知      │  │                                            │   │
│  │              │  │                                            │   │
│  │  📊 高级      │  │  ─────────────────────────────────────     │   │
│  │              │  │                                            │   │
│  └──────────────┘  │  菜单栏样式                                  │   │
│                    │                                            │   │
│                    │  ○ 仅图标                                   │   │
│                    │  ○ 图标 + 状态文字                          │   │
│                    │  ○ 图标 + 同步进度                          │   │
│                    │                                            │   │
│                    └────────────────────────────────────────────┘   │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                    [恢复默认]        [应用]         │
└─────────────────────────────────────────────────────────────────────┘
```

### 5.2 设置页面详情

#### 5.2.1 通用设置

```
┌────────────────────────────────────────────────────────────────┐
│  通用设置                                                       │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  启动选项                                                       │
│  ─────────────────────────────────────────────                 │
│  □ 登录时自动启动 DMSA                                          │
│  □ 在 Dock 中显示图标                                           │
│                                                                 │
│  更新                                                           │
│  ─────────────────────────────────────────────                 │
│  □ 自动检查更新                                                 │
│    检查频率: [每周  ▼]                                          │
│                                                                 │
│  语言                                                           │
│  ─────────────────────────────────────────────                 │
│  界面语言: [跟随系统  ▼]                                         │
│            ├─ 跟随系统                                          │
│            ├─ 简体中文                                          │
│            ├─ 繁體中文                                          │
│            └─ English                                           │
│                                                                 │
│  菜单栏样式                                                      │
│  ─────────────────────────────────────────────                 │
│  ○ 仅图标           [🔄]                                        │
│  ○ 图标 + 状态      [🔄 已连接]                                  │
│  ○ 图标 + 进度      [🔄 45%]                                    │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

#### 5.2.2 硬盘管理

```
┌────────────────────────────────────────────────────────────────┐
│  硬盘管理                                                       │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  已配置的硬盘                                    [+添加] [-删除] │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ◉ BACKUP                                     🟢 已连接   │  │
│  │    /Volumes/BACKUP                                       │  │
│  │    优先级: 1  |  格式: APFS                              │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  ○ PORTABLE                                   ⚪ 未连接   │  │
│  │    /Volumes/PORTABLE                                     │  │
│  │    优先级: 2  |  格式: exFAT                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  硬盘详情 (BACKUP)                                              │
│                                                                 │
│  名称:     [BACKUP                    ]                         │
│  挂载路径: [/Volumes/BACKUP           ] [浏览...]               │
│  优先级:   [1  ] (数字越小优先级越高)                            │
│  状态:     🟢 已连接 (450 GB / 1 TB)                            │
│                                                                 │
│  □ 启用此硬盘                                                   │
│  □ 连接时自动同步                                               │
│  □ 断开前完成同步 (安全弹出)                                     │
│                                                                 │
│                                [测试连接]                        │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

#### 5.2.3 同步对管理 (v3.0)

```
┌────────────────────────────────────────────────────────────────┐
│  同步对管理                                                     │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  v3.0 术语: TARGET_DIR (用户入口) | LOCAL_DIR (热缓存) | EXTERNAL_DIR (完整备份)
│                                                                 │
│  已配置的同步对                                 [+添加] [-删除] │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ☑ ~/Downloads (VFS 挂载)                                │  │
│  │    LOCAL: ~/Downloads_Local → EXTERNAL: BACKUP/Downloads │  │
│  │    配额: 50 GB  |  上次同步: 5分钟前                      │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  ☑ ~/Documents (VFS 挂载)                                │  │
│  │    LOCAL: ~/Documents_Local → EXTERNAL: BACKUP/Documents │  │
│  │    配额: 30 GB  |  上次同步: 1小时前                      │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  ☐ ~/Projects (硬盘未连接)                               │  │
│  │    LOCAL: ~/Projects_Local → EXTERNAL: PORTABLE/Projects │  │
│  │    配额: 100 GB  |  上次同步: 从未                        │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  同步对详情 (v3.0)                                              │
│                                                                 │
│  TARGET_DIR: [~/Downloads             ] [选择...]  (用户访问入口)
│  LOCAL_DIR:  [~/Downloads_Local       ]            (热数据缓存)
│  EXTERNAL:   [/Volumes/BACKUP/Downloads]           (完整备份)
│                                                                 │
│  本地配额:   [50   ] GB                                         │
│                                                                 │
│  同步方向:   LOCAL → EXTERNAL (v3.0 仅单向同步)                 │
│                                                                 │
│  □ 启用此同步对                                                 │
│                                                                 │
│  排除模式 (仅此同步对):                                          │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ node_modules                                      [×]  │    │
│  │ .git                                              [×]  │    │
│  │ *.log                                             [×]  │    │
│  └────────────────────────────────────────────────────────┘    │
│  [+ 添加排除模式]                                                │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

#### 5.2.4 过滤规则

```
┌────────────────────────────────────────────────────────────────┐
│  过滤规则                                                       │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  预设方案                                       [导入] [导出]   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ◉ 默认                                                  │  │
│  │    排除系统文件和临时文件                                 │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  ○ 开发者                                                │  │
│  │    额外排除 node_modules, .git, build 等                 │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  ○ 媒体文件                                              │  │
│  │    仅同步图片、视频、音频                                 │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  ○ 自定义                                                │  │
│  │    用户自定义规则                                         │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  全局排除模式                                                   │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ .DS_Store                                         [×]  │    │
│  │ .Trash                                            [×]  │    │
│  │ *.tmp                                             [×]  │    │
│  │ *.crdownload                                      [×]  │    │
│  │ Thumbs.db                                         [×]  │    │
│  └────────────────────────────────────────────────────────┘    │
│  [+ 添加]                                                       │
│                                                                 │
│  文件大小限制                                                   │
│  □ 排除大于 [     ] GB 的文件                                   │
│  □ 排除小于 [     ] KB 的文件                                   │
│                                                                 │
│  □ 排除隐藏文件 (以 . 开头)                                     │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

#### 5.2.5 LRU 淘汰设置 (v3.0)

```
┌────────────────────────────────────────────────────────────────┐
│  LRU 淘汰设置                                                   │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  本地热数据 (LOCAL_DIR)                                         │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  v3.0: 本地配额在每个同步对中单独配置 (localQuotaGB)             │
│                                                                 │
│  Downloads:  ████████░░░░░░░░░░░░  32 GB / 50 GB (64%)         │
│  Documents:  ████░░░░░░░░░░░░░░░░  12 GB / 30 GB (40%)         │
│                                                                 │
│  总计使用:   44 GB                                              │
│                                                                 │
│  预留缓冲: [500   ] MB (触发淘汰时保留给新文件)                   │
│                                                                 │
│  LRU 淘汰策略 (v3.0 默认)                                       │
│  ─────────────────────────────────────────────                 │
│  ◉ 按访问时间 (LRU) - 优先淘汰最久未访问的文件                   │
│  ○ 按文件大小 - 优先淘汰大文件 (释放空间更快)                    │
│                                                                 │
│  淘汰条件 (v3.0):                                               │
│    • 文件状态为 BOTH (已同步到 EXTERNAL)                        │
│    • 文件不是脏数据 (isDirty = false)                           │
│    • 淘汰前验证 EXTERNAL 中文件存在                              │
│                                                                 │
│  □ 启用自动淘汰                                                 │
│    检查间隔: [5    ] 分钟                                       │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  ⚠️ v3.0 注意: 淘汰仅删除 LOCAL_DIR 中的文件副本                │
│     文件仍可通过 VFS 从 EXTERNAL_DIR 直接读取 (零拷贝)           │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

#### 5.2.6 通知设置

```
┌────────────────────────────────────────────────────────────────┐
│  通知设置                                                       │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  □ 启用通知                                                     │
│                                                                 │
│  通知类型                                                       │
│  ─────────────────────────────────────────────                 │
│  ☑ 硬盘连接时通知                                               │
│  ☑ 硬盘断开时通知                                               │
│  ☐ 同步开始时通知                                               │
│  ☑ 同步完成时通知                                               │
│  ☑ 同步失败时通知                                               │
│  ☑ 缓存空间不足时通知                                           │
│                                                                 │
│  通知样式                                                       │
│  ─────────────────────────────────────────────                 │
│  □ 播放提示音                                                   │
│  □ 显示同步详情 (文件数、大小、耗时)                             │
│                                                                 │
│  勿扰模式                                                       │
│  ─────────────────────────────────────────────                 │
│  □ 跟随系统勿扰模式                                             │
│  □ 自定义勿扰时间: [22:00] - [08:00]                            │
│                                                                 │
│                                        [发送测试通知]            │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

#### 5.2.7 高级设置

```
┌────────────────────────────────────────────────────────────────┐
│  高级设置                                                       │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  同步行为                                                       │
│  ─────────────────────────────────────────────                 │
│  防抖延迟:   [5    ] 秒 (文件变化后等待时间)                     │
│  批处理大小: [100  ] 个文件                                      │
│  重试次数:   [3    ] 次                                         │
│  超时时间:   [300  ] 秒                                         │
│                                                                 │
│  rsync 选项                                                     │
│  ─────────────────────────────────────────────                 │
│  ☑ 归档模式 (-a)                                                │
│  ☑ 删除目标多余文件 (--delete)                                  │
│  ☐ 使用校验和 (--checksum) - 更准确但更慢                       │
│  ☑ 断点续传 (--partial)                                         │
│  ☐ 压缩传输 (-z) - 网络存储时启用                               │
│                                                                 │
│  日志                                                           │
│  ─────────────────────────────────────────────                 │
│  日志级别: [Info     ▼]                                         │
│            ├─ Debug (详细)                                      │
│            ├─ Info (标准)                                       │
│            ├─ Warning (警告)                                    │
│            └─ Error (仅错误)                                    │
│  日志大小: [10   ] MB                                           │
│  保留数量: [5    ] 个                                           │
│                                        [打开日志文件夹]          │
│                                                                 │
│  数据                                                           │
│  ─────────────────────────────────────────────                 │
│  [导出配置...]  [导入配置...]  [重置所有设置...]                 │
│                                                                 │
│  ⚠️ 危险操作                                                    │
│  [清除所有数据并重置...]                                         │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

---

## 6. 同步进度窗口

### 6.1 进度窗口布局

```
┌────────────────────────────────────────────────────────────────┐
│  正在同步...                                              ✕    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📁 Downloads → BACKUP                                         │
│                                                                 │
│  ████████████████████░░░░░░░░░░░░░░░░░░░░  45%                 │
│                                                                 │
│  当前文件: project_backup_2026.zip                              │
│  进度: 156 / 347 文件  |  1.2 GB / 2.8 GB                       │
│  速度: 45 MB/s  |  剩余时间: 约 35 秒                            │
│                                                                 │
├────────────────────────────────────────────────────────────────┤
│  [隐藏窗口]                                        [取消同步]   │
└────────────────────────────────────────────────────────────────┘
```

### 6.2 多任务进度

```
┌────────────────────────────────────────────────────────────────┐
│  同步进度                                                 ✕    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  正在执行 2 个同步任务                                          │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 📁 Downloads → BACKUP                           [取消]   │  │
│  │ ████████████████████░░░░░░░░░░  67%                      │  │
│  │ 234 / 347 文件  |  1.9 GB / 2.8 GB  |  32 MB/s           │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │ 📁 Documents → BACKUP                           [取消]   │  │
│  │ ████████░░░░░░░░░░░░░░░░░░░░░░  23%                      │  │
│  │ 45 / 198 文件  |  0.5 GB / 2.1 GB  |  等待中...           │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
├────────────────────────────────────────────────────────────────┤
│  [最小化]                                         [全部取消]   │
└────────────────────────────────────────────────────────────────┘
```

---

## 7. 历史记录窗口

### 7.1 历史窗口布局

```
┌─────────────────────────────────────────────────────────────────────┐
│  📊 同步历史                                           ─  □  ✕     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  筛选: [全部硬盘    ▼]  [全部状态  ▼]  [最近7天  ▼]    🔍 [搜索...]  │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  今天                                                                │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ ✅  14:32  Downloads → BACKUP                                 │  │
│  │     156 文件  |  1.2 GB  |  耗时 45s                          │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │ ✅  10:15  Documents → BACKUP                                 │  │
│  │     89 文件  |  450 MB  |  耗时 12s                           │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  昨天                                                                │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ ❌  18:45  Downloads → BACKUP                                 │  │
│  │     错误: 硬盘意外断开                                         │  │
│  │     [查看详情]  [重试]                                        │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │ ✅  09:30  Downloads → BACKUP                                 │  │
│  │     234 文件  |  2.1 GB  |  耗时 1m 23s                       │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  2026-01-18                                                          │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │ ✅  16:20  Documents → BACKUP                                 │  │
│  │     45 文件  |  120 MB  |  耗时 5s                            │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  统计: 本周共同步 12 次  |  成功 11 次  |  失败 1 次                 │
│        传输 2,456 文件  |  总计 15.6 GB                              │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  [导出历史...]                                      [清除历史...]   │
└─────────────────────────────────────────────────────────────────────┘
```

### 7.2 历史详情面板

```
┌────────────────────────────────────────────────────────────────┐
│  同步详情                                                 ✕    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  状态: ✅ 成功                                                  │
│  时间: 2026-01-20 14:32:45                                     │
│  耗时: 45 秒                                                   │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  同步方向: Downloads → BACKUP/Downloads                        │
│  硬盘:     BACKUP (/Volumes/BACKUP)                            │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  传输统计:                                                      │
│    文件数量: 156 个                                             │
│    总大小:   1.2 GB                                            │
│    新增:     23 个文件                                          │
│    更新:     45 个文件                                          │
│    删除:     12 个文件                                          │
│    跳过:     76 个文件 (未变化)                                  │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  rsync 输出:                                                    │
│  ┌────────────────────────────────────────────────────────┐    │
│  │ sending incremental file list                          │    │
│  │ ./                                                     │    │
│  │ project_backup_2026.zip                                │    │
│  │ documents/report.pdf                                   │    │
│  │ ...                                                    │    │
│  └────────────────────────────────────────────────────────┘    │
│                                                                 │
│                                              [复制日志] [关闭]  │
└────────────────────────────────────────────────────────────────┘
```

---

## 8. 首次启动向导

### 8.1 向导流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                      │
│  步骤指示器:  ① 欢迎  ─  ② 硬盘  ─  ③ 目录  ─  ④ 权限  ─  ⑤ 完成   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.2 步骤 1: 欢迎

```
┌─────────────────────────────────────────────────────────────────────┐
│                          欢迎使用 DMSA                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│                            🔄                                        │
│                                                                      │
│                    Delt MACOS Sync App                              │
│                         版本 3.0                                     │
│                                                                      │
│  ─────────────────────────────────────────────────────────────────  │
│                                                                      │
│  DMSA 通过 VFS 虚拟文件系统，让您无缝访问本地和外置硬盘的数据。       │
│                                                                      │
│  主要功能 (v3.0):                                                    │
│    ✓ VFS 智能合并 - ~/Downloads 同时显示本地和外置数据               │
│    ✓ 零拷贝读取 - 外置文件直接读取，无需复制                         │
│    ✓ Write-Back 写入 - 写入本地，异步同步到外置                      │
│    ✓ LRU 智能淘汰 - 自动管理本地缓存空间                             │
│                                                                      │
│                                                                      │
│                                                                      │
│                                                                      │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                        [开始设置 →] │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.3 步骤 2: 添加硬盘

```
┌─────────────────────────────────────────────────────────────────────┐
│                          添加您的硬盘                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  请选择要同步的外置硬盘:                                             │
│                                                                      │
│  检测到的硬盘:                                                       │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │  ☑  💾 BACKUP                                                 │  │
│  │      /Volumes/BACKUP                                          │  │
│  │      格式: APFS  |  容量: 1 TB  |  可用: 550 GB               │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  ☐  💾 Macintosh HD                                  (系统盘) │  │
│  │      /                                                        │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  没有看到您的硬盘?                                                   │
│  [+ 手动添加硬盘...]                                                 │
│                                                                      │
│  💡 提示: 您可以稍后在设置中添加更多硬盘                              │
│                                                                      │
│                                                                      │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  [← 上一步]                                            [下一步 →]   │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.4 步骤 3: 选择目录

```
┌─────────────────────────────────────────────────────────────────────┐
│                        选择要同步的目录                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  选择要同步到 BACKUP 的本地目录:                                     │
│                                                                      │
│  推荐目录:                                                           │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │  ☑  📁 Downloads                                              │  │
│  │      ~/Downloads  →  BACKUP/Downloads                         │  │
│  │      当前大小: 2.8 GB                                         │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  ☐  📁 Documents                                              │  │
│  │      ~/Documents  →  BACKUP/Documents                         │  │
│  │      当前大小: 1.5 GB                                         │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  ☐  📁 Desktop                                                │  │
│  │      ~/Desktop  →  BACKUP/Desktop                             │  │
│  │      当前大小: 320 MB                                         │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  [+ 添加自定义目录...]                                               │
│                                                                      │
│  同步选项:                                                           │
│  ☑ 创建符号链接 (本地目录指向外置硬盘)                               │
│  ☑ 硬盘连接时自动同步                                                │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  [← 上一步]                                            [下一步 →]   │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.5 步骤 4: 权限设置 (v3.0)

```
┌─────────────────────────────────────────────────────────────────────┐
│                          授予必要权限                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  DMSA v3.0 需要以下组件和权限:                                       │
│                                                                      │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │  📦  FUSE-T (必需)                                 [安装...]   │  │
│  │      状态: ⚠️ 未安装                                          │  │
│  │      用于: VFS 虚拟文件系统挂载                                │  │
│  │      说明: FUSE-T 是纯用户空间实现，无需内核扩展               │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │  🔐  完全磁盘访问权限                               [授权...]  │  │
│  │      状态: ⚠️ 未授权                                          │  │
│  │      用于: 访问 Downloads、Documents 等目录                   │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │  🔔  通知权限                                       [授权...]  │  │
│  │      状态: ✅ 已授权                                          │  │
│  │      用于: 同步完成、错误提醒                                  │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  💡 FUSE-T 安装说明:                                                 │
│  1. 点击"安装"打开 FUSE-T 官网下载页面                              │
│  2. 下载并安装 FUSE-T.pkg                                           │
│  3. 安装完成后返回此窗口                                             │
│                                                                      │
│  💡 这些权限仅用于 VFS 和同步功能，DMSA 不会收集您的个人数据          │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  [← 上一步]                                            [下一步 →]   │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.6 步骤 5: 完成

```
┌─────────────────────────────────────────────────────────────────────┐
│                            设置完成!                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│                             ✅                                       │
│                                                                      │
│                       DMSA v3.0 已准备就绪                           │
│                                                                      │
│  ─────────────────────────────────────────────────────────────────  │
│                                                                      │
│  您的配置 (v3.0 VFS 模式):                                           │
│                                                                      │
│    TARGET_DIR: ~/Downloads (VFS 挂载点 - 您的访问入口)               │
│    LOCAL_DIR:  ~/Downloads_Local (本地热数据缓存)                    │
│    EXTERNAL:   BACKUP/Downloads (外置完整备份)                       │
│    本地配额:   50 GB                                                 │
│                                                                      │
│  ─────────────────────────────────────────────────────────────────  │
│                                                                      │
│  接下来:                                                             │
│    • ~/Downloads 现在是 VFS 挂载点，显示本地+外置文件合并视图         │
│    • 写入文件 → 保存到本地 → 自动同步到外置硬盘                       │
│    • 读取外置文件 → 直接从外置硬盘读取 (零拷贝)                       │
│    • 本地空间不足时 → LRU 自动淘汰旧文件                              │
│                                                                      │
│  ☑ 登录时自动启动 DMSA                                               │
│  ☐ 立即扫描文件树并构建索引                                          │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                        [完成]       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 9. 通知设计

### 9.1 通知类型

```
┌─────────────────────────────────────────────────────────────────────┐
│                           通知类型设计                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  硬盘连接                                                            │
│  ┌───────────────────────────────────────────────┐                  │
│  │  🔄 DMSA                               现在    │                  │
│  │  外置硬盘已连接                                │                  │
│  │  BACKUP 已连接，准备同步                       │                  │
│  └───────────────────────────────────────────────┘                  │
│                                                                      │
│  硬盘断开                                                            │
│  ┌───────────────────────────────────────────────┐                  │
│  │  🔄 DMSA                               现在    │                  │
│  │  外置硬盘已断开                                │                  │
│  │  BACKUP 已安全断开                             │                  │
│  └───────────────────────────────────────────────┘                  │
│                                                                      │
│  同步完成                                                            │
│  ┌───────────────────────────────────────────────┐                  │
│  │  🔄 DMSA                               现在    │                  │
│  │  同步完成                                      │                  │
│  │  已同步 156 个文件 (1.2 GB)，耗时 45 秒        │                  │
│  └───────────────────────────────────────────────┘                  │
│                                                                      │
│  同步失败                                                            │
│  ┌───────────────────────────────────────────────┐                  │
│  │  🔄 DMSA                               现在    │                  │
│  │  ⚠️ 同步失败                                   │                  │
│  │  硬盘意外断开，点击查看详情                     │                  │
│  └───────────────────────────────────────────────┘                  │
│                                                                      │
│  缓存警告                                                            │
│  ┌───────────────────────────────────────────────┐                  │
│  │  🔄 DMSA                               现在    │                  │
│  │  本地缓存空间不足                              │                  │
│  │  已使用 9.5 GB / 10 GB，正在清理旧文件        │                  │
│  └───────────────────────────────────────────────┘                  │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 10. 错误与恢复界面

### 10.1 错误弹窗

```
┌────────────────────────────────────────────────────────────────┐
│  ⚠️ 同步错误                                              ✕    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│                          ⚠️                                     │
│                                                                 │
│  无法完成同步                                                   │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  错误原因: 硬盘 BACKUP 在同步过程中意外断开                      │
│                                                                 │
│  已同步: 89 / 156 文件                                          │
│  未同步: 67 文件将在下次连接时继续                               │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  建议:                                                          │
│  • 确保硬盘连接稳固                                             │
│  • 避免在同步时拔出硬盘                                         │
│  • 使用"安全弹出"功能                                          │
│                                                                 │
├────────────────────────────────────────────────────────────────┤
│  [查看日志]              [忽略]              [重新连接并重试]   │
└────────────────────────────────────────────────────────────────┘
```

### 10.2 恢复向导

```
┌────────────────────────────────────────────────────────────────┐
│  🔧 数据恢复向导                                          ✕    │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│  检测到数据不一致，请选择恢复方式:                               │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  问题描述:                                                      │
│  本地目录 ~/Downloads 是符号链接，但目标硬盘 BACKUP 未连接      │
│                                                                 │
│  ─────────────────────────────────────────────                 │
│                                                                 │
│  恢复选项:                                                      │
│                                                                 │
│  ○ 等待硬盘连接                                                 │
│    保持当前状态，硬盘连接后自动恢复                              │
│                                                                 │
│  ○ 恢复本地备份                                                 │
│    删除符号链接，恢复 ~/Local_Downloads 备份                    │
│    ⚠️ 可能丢失硬盘上的新增文件                                  │
│                                                                 │
│  ○ 创建新的本地目录                                             │
│    删除符号链接，创建空的 ~/Downloads                           │
│    ⚠️ 所有文件将仅在硬盘上                                      │
│                                                                 │
├────────────────────────────────────────────────────────────────┤
│  [取消]                                              [执行恢复] │
└────────────────────────────────────────────────────────────────┘
```

---

## 11. 深色模式适配

### 11.1 颜色方案

```
┌─────────────────────────────────────────────────────────────────────┐
│                         颜色方案对照                                 │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  元素              浅色模式              深色模式                     │
│  ─────────────────────────────────────────────────────────────────  │
│  背景              #FFFFFF               #1E1E1E                    │
│  二级背景          #F5F5F7               #2D2D2D                    │
│  文字              #1D1D1F               #FFFFFF                    │
│  二级文字          #86868B               #A1A1A6                    │
│  分隔线            #D2D2D7               #3D3D3D                    │
│  卡片背景          #FFFFFF               #2D2D2D                    │
│  卡片边框          #E5E5E5               #3D3D3D                    │
│  选中状态          #007AFF               #0A84FF                    │
│  成功              #34C759               #30D158                    │
│  警告              #FF9500               #FF9F0A                    │
│  错误              #FF3B30               #FF453A                    │
│                                                                      │
│  注: 使用 SwiftUI 语义颜色自动适配                                   │
│      Color(.windowBackgroundColor)                                   │
│      Color(.labelColor)                                              │
│      Color(.secondaryLabelColor)                                     │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 11.2 图标适配

```
使用 SF Symbols 确保图标在深色模式下正确显示:
- 设置 renderingMode(.template) 使图标跟随系统颜色
- 使用 .symbolVariant(.fill) 控制填充样式
- 优先使用 hierarchical 或 palette 渲染模式
```

---

## 12. 交互动画

### 12.1 动画规范

| 动画类型 | 时长 | 曲线 | 用途 |
|----------|------|------|------|
| 菜单展开 | 200ms | easeOut | 下拉菜单出现 |
| 窗口出现 | 250ms | spring | 窗口弹出 |
| 进度更新 | 100ms | linear | 进度条更新 |
| 状态切换 | 300ms | easeInOut | 图标状态变化 |
| 同步旋转 | 1000ms | linear | 同步中图标旋转 |

### 12.2 关键动画

```swift
// 菜单栏同步动画
Animation.linear(duration: 1.0).repeatForever(autoreverses: false)

// 进度条动画
Animation.easeInOut(duration: 0.3)

// 窗口出现动画
Animation.spring(response: 0.3, dampingFraction: 0.8)
```

---

## 13. 键盘快捷键

### 13.1 全局快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| ⌘S | 立即同步 | 触发手动同步 (菜单栏) |
| ⌘O | 打开 Downloads | 在 Finder 中打开 |
| ⌘L | 查看日志 | 打开日志文件 |
| ⌘H | 同步历史 | 打开历史窗口 |
| ⌘, | 设置 | 打开设置窗口 |
| ⌘Q | 退出 | 退出应用 |

### 13.2 窗口内快捷键

| 快捷键 | 功能 | 窗口 |
|--------|------|------|
| ⌘W | 关闭窗口 | 所有窗口 |
| ⌘+ / ⌘- | 放大/缩小 | 历史窗口 |
| ⌘F | 搜索 | 历史窗口 |
| ⌘A | 全选 | 列表窗口 |
| ⌘C | 复制 | 历史详情 |
| Esc | 取消/关闭 | 所有窗口 |
| ↑↓ | 导航 | 列表项 |
| Space | 选中/取消 | 复选框 |
| Enter | 确认 | 对话框 |

---

## 14. 无障碍设计

### 14.1 VoiceOver 支持

```swift
// 为所有可交互元素添加 accessibility 标签
Button("立即同步") { ... }
    .accessibilityLabel("立即同步")
    .accessibilityHint("双击开始同步所有已配置的目录")

// 状态变化通知
.accessibilityValue(isConnected ? "已连接" : "未连接")

// 进度通知
.accessibilityValue("同步进度 \(Int(progress * 100))%")
```

### 14.2 动态字体

```swift
// 支持动态字体
.font(.body)
.dynamicTypeSize(.large ... .accessibility5)

// 固定关键元素大小
.font(.system(size: 13, design: .monospaced))
.dynamicTypeSize(.large)
```

### 14.3 高对比度

```swift
// 使用语义颜色
Color(.labelColor)
Color(.secondaryLabelColor)
Color(.separatorColor)

// 避免纯透明度区分
// ❌ Color.white.opacity(0.5)
// ✅ Color(.secondarySystemBackground)
```

---

## 15. SwiftUI 组件规范

### 15.1 项目结构

```
Sources/DMSA/UI/
├── Views/
│   ├── MenuBar/
│   │   ├── MenuBarView.swift           # 菜单栏主视图
│   │   ├── DiskStatusCard.swift        # 硬盘状态卡片
│   │   └── SyncPairRow.swift           # 同步对行
│   │
│   ├── Settings/
│   │   ├── SettingsView.swift          # 设置主窗口
│   │   ├── GeneralSettingsView.swift   # 通用设置
│   │   ├── DiskSettingsView.swift      # 硬盘管理
│   │   ├── SyncPairSettingsView.swift  # 同步对管理
│   │   ├── FilterSettingsView.swift    # 过滤规则
│   │   ├── CacheSettingsView.swift     # 缓存设置
│   │   ├── NotificationSettingsView.swift # 通知设置
│   │   └── AdvancedSettingsView.swift  # 高级设置
│   │
│   ├── Progress/
│   │   ├── SyncProgressView.swift      # 同步进度窗口
│   │   └── ProgressBar.swift           # 进度条组件
│   │
│   ├── History/
│   │   ├── HistoryView.swift           # 历史窗口
│   │   ├── HistoryRow.swift            # 历史记录行
│   │   └── HistoryDetailView.swift     # 历史详情
│   │
│   ├── Wizard/
│   │   ├── WizardView.swift            # 向导主视图
│   │   ├── WelcomeStep.swift           # 欢迎步骤
│   │   ├── DiskStep.swift              # 硬盘步骤
│   │   ├── DirectoryStep.swift         # 目录步骤
│   │   ├── PermissionStep.swift        # 权限步骤
│   │   └── CompleteStep.swift          # 完成步骤
│   │
│   └── Common/
│       ├── ErrorView.swift             # 错误视图
│       ├── RecoveryWizard.swift        # 恢复向导
│       └── AboutView.swift             # 关于窗口
│
├── Components/
│   ├── SettingRow.swift                # 设置行组件
│   ├── SectionHeader.swift             # 分组标题
│   ├── DiskCard.swift                  # 硬盘卡片
│   ├── ToggleRow.swift                 # 开关行
│   ├── SliderRow.swift                 # 滑块行
│   ├── PickerRow.swift                 # 选择器行
│   ├── PatternListEditor.swift         # 模式列表编辑器
│   └── StorageBar.swift                # 存储条
│
├── Styles/
│   ├── ButtonStyles.swift              # 按钮样式
│   ├── TextStyles.swift                # 文字样式
│   └── CardStyles.swift                # 卡片样式
│
└── Extensions/
    ├── Color+DMSA.swift                # 颜色扩展
    ├── View+Window.swift               # 窗口辅助
    └── Animation+DMSA.swift            # 动画扩展
```

### 15.2 核心组件示例

```swift
// SettingRow.swift
struct SettingRow<Content: View>: View {
    let title: String
    let description: String?
    let content: Content

    init(title: String, description: String? = nil, @ViewBuilder content: () -> Content) {
        self.title = title
        self.description = description
        self.content = content()
    }

    var body: some View {
        HStack {
            VStack(alignment: .leading, spacing: 2) {
                Text(title)
                    .font(.body)
                if let description = description {
                    Text(description)
                        .font(.caption)
                        .foregroundColor(.secondary)
                }
            }
            Spacer()
            content
        }
        .padding(.vertical, 4)
    }
}

// DiskCard.swift
struct DiskCard: View {
    let disk: DiskConfig
    let isSelected: Bool
    let onSelect: () -> Void

    var body: some View {
        HStack {
            Image(systemName: "externaldrive.fill")
                .foregroundColor(disk.isConnected ? .green : .gray)

            VStack(alignment: .leading) {
                Text(disk.name)
                    .font(.headline)
                Text(disk.mountPath)
                    .font(.caption)
                    .foregroundColor(.secondary)
            }

            Spacer()

            if disk.isConnected {
                Text("已连接")
                    .font(.caption)
                    .foregroundColor(.green)
            }
        }
        .padding()
        .background(isSelected ? Color.accentColor.opacity(0.1) : Color(.windowBackgroundColor))
        .cornerRadius(8)
        .overlay(
            RoundedRectangle(cornerRadius: 8)
                .stroke(isSelected ? Color.accentColor : Color.clear, lineWidth: 2)
        )
        .onTapGesture(perform: onSelect)
    }
}

// StorageBar.swift
struct StorageBar: View {
    let used: Int64
    let total: Int64

    var percentage: Double {
        guard total > 0 else { return 0 }
        return Double(used) / Double(total)
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 4) {
            GeometryReader { geometry in
                ZStack(alignment: .leading) {
                    RoundedRectangle(cornerRadius: 4)
                        .fill(Color(.separatorColor))

                    RoundedRectangle(cornerRadius: 4)
                        .fill(barColor)
                        .frame(width: geometry.size.width * CGFloat(percentage))
                }
            }
            .frame(height: 8)

            HStack {
                Text(ByteCountFormatter.string(fromByteCount: used, countStyle: .file))
                    .font(.caption)
                Spacer()
                Text("\(Int(percentage * 100))%")
                    .font(.caption)
                    .foregroundColor(.secondary)
                Spacer()
                Text(ByteCountFormatter.string(fromByteCount: total, countStyle: .file))
                    .font(.caption)
            }
        }
    }

    var barColor: Color {
        if percentage > 0.9 { return .red }
        if percentage > 0.7 { return .orange }
        return .accentColor
    }
}
```

---

## 附录: 设计资源

### 图标资源

| 用途 | SF Symbol |
|------|-----------|
| 应用图标 (菜单栏) | arrow.triangle.2.circlepath |
| 硬盘 | externaldrive.fill |
| 文件夹 | folder.fill |
| 设置 | gearshape.fill |
| 同步 | arrow.triangle.2.circlepath |
| 历史 | clock.fill |
| 日志 | doc.text.fill |
| 成功 | checkmark.circle.fill |
| 警告 | exclamationmark.triangle.fill |
| 错误 | xmark.circle.fill |
| 添加 | plus.circle.fill |
| 删除 | minus.circle.fill |
| 关于 | info.circle.fill |
| 退出 | power |

### 本地化

```
支持语言:
- 简体中文 (zh-Hans)
- 繁体中文 (zh-Hant)
- English (en)

本地化文件: Resources/Localizable.strings
```

---

*文档维护: UI/UX 变更时更新此文档*
